const minify=require("@node-minify/core"),terser=require("@node-minify/terser"),csso=require("@node-minify/csso"),htmlMinifier=require("@node-minify/html-minifier"),jsonMinify=require("@node-minify/jsonminify"),fs=require("fs"),path=require("path"),originUrl=path.join(__dirname,"\\../../"),outputUrl=path.join(__dirname,"\\../../output");function minifier(){copyDir(originUrl,outputUrl,{}),fs.readdirSync(outputUrl).forEach((function(i){try{-1!=i.indexOf(".js")?minify({compressor:terser,input:path.join(originUrl,i),output:path.join(outputUrl,i),callback:function(i,n){}}):-1!=i.indexOf(".css")&&minify({compressor:csso,input:path.join(originUrl,i),output:path.join(outputUrl,i),callback:function(i,n){}})}catch(i){console.log(i)}})),fs.readdirSync(path.join(originUrl,"locales")).forEach((function(i){try{-1!=i.indexOf(".json")&&minify({compressor:jsonMinify,input:path.join(path.join(originUrl,"locales"),i),output:path.join(path.join(outputUrl,"locales"),i),callback:function(i,n){}})}catch(i){console.log(i)}})),setTimeout((function(){console.log("\nMinification finished. If you saw some warnings, just ignore them - in most cases, wnr will be fine. ")}),500)}function removePromise(i){return new Promise((function(n,o){fs.stat(i,(function(o,r){r.isDirectory()?fs.readdir(i,(function(o,r){r=(r=r.map(n=>path.join(i,n))).map(i=>removePromise(i)),Promise.all(r).then((function(){fs.rmdir(i,n)}))})):fs.unlink(i,n)}))}))}function copyDir(i,n,o={}){let r=i,t=n;if(o.relative){path.resolve(process.cwd(),i),path.join(process.cwd(),n)}_copydir(r,t)}function _copydir(i,n){try{fs.accessSync(n)}catch(i){fs.mkdirSync(n)}try{fs.readdirSync(i).forEach((function(o){let r=i+"/"+o,t=n+"/"+o;try{let i=fs.statSync(r);i.isFile()?fs.writeFileSync(t,fs.readFileSync(r)):i.isDirectory()&&"designs"!=o&&"packaged"!=o&&".git"!=o&&"output"!=o&&_copydir(r,t)}catch(i){console.log(i)}}))}catch(i){console.log(i)}}fs.existsSync(outputUrl)?removePromise(outputUrl).then(()=>{minifier()}):minifier();